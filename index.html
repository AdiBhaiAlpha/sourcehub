<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SourceHub - Your Gateway to Knowledge Sharing</title>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDDOMfizL6pjT40qisJqI14o5R5IiK27OQ",
            authDomain: "social-6e0ee.firebaseapp.com",
            projectId: "social-6e0ee",
            storageBucket: "social-6e0ee.appspot.com",
            messagingSenderId: "246903005794",
            appId: "1:246903005794:web:8951084e46924a5551273b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        
        // Initialize services
        const database = getDatabase(app);
        const storage = getStorage(app);

        // Function to display posts
        function displayPosts() {
            const postsDiv = document.getElementById('posts');
            postsDiv.innerHTML = ''; // Clear existing posts

            const postsRef = ref(database, 'posts');
            onValue(postsRef, (snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const post = childSnapshot.val();
                        postsDiv.innerHTML += `
                            <div class="post">
                                <h3>${post.title}</h3>
                                <p>${post.content}</p>
                                ${post.fileURL ? `<a href="${post.fileURL}" target="_blank">View Uploaded File</a>` : ''}
                            </div>
                        `;
                    });
                } else {
                    postsDiv.innerHTML = "<p>No posts available.</p>"; // Show message if no posts
                }
            }, (error) => {
                console.error("Error fetching posts:", error);
            });
        }

        // Function to save post
        function savePost(title, content, fileURL) {
            const newPostRef = ref(database, 'posts/' + Date.now()); // Using a timestamp for unique key
            set(newPostRef, {
                title: title,
                content: content,
                fileURL: fileURL,
                timestamp: Date.now()
            })
            .then(() => {
                alert('Post uploaded successfully!'); // Alert on success
                displayPosts(); // Refresh posts after adding a new one
                document.getElementById('postForm').reset(); // Clear the form
            })
            .catch((error) => {
                console.error("Error saving post:", error);
                alert('Post upload failed: ' + error.message); // Alert on error
            });
        }

        // Form submission handling
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('postForm').addEventListener('submit', function (event) {
                event.preventDefault();

                const title = document.getElementById('postTitle').value;
                const content = document.getElementById('postContent').value;
                const fileInput = document.getElementById('fileInput').files[0];

                if (fileInput) {
                    const storageReference = storageRef(storage, 'uploads/' + fileInput.name);
                    uploadBytes(storageReference, fileInput).then((snapshot) => {
                        console.log('Uploaded a blob or file!', snapshot);
                        getDownloadURL(storageReference).then((downloadURL) => {
                            savePost(title, content, downloadURL);
                        });
                    }).catch((error) => {
                        console.error("Upload failed:", error);
                        alert('File upload failed: ' + error.message); // Alert on file upload error
                    });
                } else {
                    savePost(title, content, null);
                }
            });

            // Initial call to display posts
            displayPosts();
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .post {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h3 {
            margin: 0 0 5px;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        footer a {
            color: #0066cc;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>SourceHub</h1>
    <form id="postForm">
        <input type="text" id="postTitle" placeholder="Post Title" required>
        <textarea id="postContent" placeholder="Post Content" required></textarea>
        <input type="file" id="fileInput">
        <button type="submit">Submit Post</button>
    </form>

    <div id="posts"></div>

    <footer>
        &copy; 2024 Chitron Bhattacharjee. All rights reserved. | <a href="https://www.brandchitron.github.com/biograph" target="_blank">About Me</a>
    </footer>
</body>
</html>
